

1.Cookie介绍

1.1 什么是Cookie
Cookie 在计算机中是个存储在浏览器目录中的文本文件，当浏览器运行时，存储在 RAM 中发挥作用 （此种 Cookies 称作 Session Cookies），
一旦用户从该网站或服务器退出，Cookie 可存储在用户本地的硬盘上 （此种 Cookies 称作 Persistent Cookies）。



1.2 Cookie时效性简单说明


1.2.1 Cookie时效性管理
目前有些 Cookie 是临时的，有些则是持续的。临时的 Cookie 只在浏览器上保存一段规定的时间，一旦超过规定的时间，该 Cookie 就会被系统清除。
Cookie的管理又分为持久化Cookie和非持久化Cookie。非持久化Cookie存储在内存中，也就意味着，其生命周期基本和app保持一致,app关闭后，Cookie丢失。
而持久化Cookie则是存储在本地磁盘中，app关闭后不丢失。




1.3 Cookie使用执行流程
首先，客户端会发送一个http请求到服务器端，服务器端接受客户端请求后，发送一个http响应到客户端，这个响应头，其中就包含Set-Cookie头部。




1.4 Android中Cookie使用


1.4.1 Android中Cookie简单介绍

通过OkhttpClient中的CookieJar或者拦截器去管理Cookie的。理论上，我们只需在构建单例OkhttpClient的时候，设置cookiejar或者拦截器，然后具体的操作（具体的操作也就是保存Cookie，取Cookie），Okhttp框架就会帮我们自动管理Cookie。




1.6 Android中如何使用Cookie的持久化
1.6.1 使用Cookie的持久化策略步骤

第一步：通过响应拦截器从response取出cookie并保存到本地，通过请求拦截器从本地取出cookie并添加到请求中
第二步：自定义CookieJar子类，实现CookieJar,在saveFromResponse()中保存cookie到本地，在loadForRequest()从本地取出cookie
第三步：注意在Android中，建议使用sp存储cookie，轻量级存储到本地








2.Session介绍

2.1 什么是Session
Session是对于服务端来说的，客户端是没有Session一说的。Session是服务器在和客户端建立连接时添加客户端连接标志，
最终会在服务器软件（Apache、Tomcat、JBoss）转化为一个临时Cookie发送给给客户端，
当客户端第一请求时服务器会检查是否携带了这个Session（临时Cookie），如果没有则会添加Session，如果有就拿出这个Session来做相关操作。


2.2 Session的作用
Session 就是在一次会话中解决2次HTTP的请求的关联，让它们产生联系，让2两个页面都能读取到找个这个全局的session信息。session信息存在于服务器端，所以也就很好的解决了安全问题。




3.Token介绍
3.1 Token的作用
token是用户身份的验证方式，我们通常叫它：令牌。最简单的token组成:uid(用户唯一的身份标识)、time(当前时间的时间戳)、sign(签名，由token的前几位+盐以哈希算法压缩成一定长的十六进制字符串，可以防止恶意第三方拼接token请求服务器)。
还可以把不变的参数也放进token，避免多次查库。
token意为令牌，通常是由客户端携带IMEI/Mac到服务器，服务器根据客户端的IMEI/Mac生成一段字符串并返回给客户端，并为其设置有效期。
以此作为客户端和服务端交互的令牌。客户端每次请求都会携带token到服务器来代替用户名和密码。
服务端验证token有效后则返回数据给客户端，否则返回特定的错误码给客户端。客户端根据错误码去做相应的处理。


3.2 Token的使用场景分析
应用场景：
A：当用户首次登录成功（注册也是一种可以适用的场景）之后, 服务器端就会生成一个 token 值，这个值，会在服务器保存token值(保存在数据库中)，再将这个token值返回给客户端.
B：客户端拿到 token 值之后,进行本地保存。（SP存储是大家能够比较支持和易于理解操作的存储）
C：当客户端再次发送网络请求(一般不是登录请求)的时候,就会将这个 token 值附带到参数中发送给服务器.
D：服务器接收到客户端的请求之后,会取出token值与保存在本地(数据库)中的token值做对比
对比一：如果两个 token 值相同， 说明用户登录成功过!当前用户处于登录状态!
对比二：如果没有这个 token 值, 则说明没有登录成功.
对比三：如果 token 值不同: 说明原来的登录信息已经失效,让用户重新登录.


3.3    那么为什么引入token机制呢？

（1）保证安全性。如果不引入token机制，那么我们每次请求数据都要携带用户名和密码。也就是每次请求数据用户名和密码都会在网络上传输。
这样大大增加了安全风险，很容易被黑客截取。因此引入token机制也一定程度上保证了安全性。
（2）减小服务器压力。在引入token机制前，我们需要通过用户名和密码到服务器去验证用户身份是否合法。
服务器认证用户名和密码是一个查询操作，如果用户量大，那么就会相应增加服务器的压力。
而引入token机制后，服务器就可以将token作为一个用户的唯一标识来验证用户身份是否合法。
这样可以大大减少服务器的压力。


3.4 、token机制的验证流程

    token的验证流程并非唯一的，至于使用怎样的验证流程可以自行确定。本文中采用OAuth2.0协议实现token验证机制。
    主要步骤如下：

        通过用户名和密码登录成功获取token和refreshToken并保存到本地。
        token的有效期为2小时，refreshToken的有效期为15天。
        每次网络请求都需要带上token，而不必带上refreshToken。
        如果服务器端判断token过期，则返回对应的错误码，客户端判断错误码后调用刷新token接口,重新获取token和refreshToken并存储。
        如果连续15天未使用app或者用户修改了密码，则refreshToken过期，需要重新登录获取token和refreshToken。


 
3.5 token自动刷新 (RxJava+Retrofit封装的)

      由于token的有效期较短，因此我们需要经常刷新token来保证token的有效性.在请求网络的时候如果token过期或者无效服务器会给我们返回对应的错误码。我们需要根据状态码来判断token是否失效。如果失效则调用刷新token接口重新获取token。如果refreshToekn也过期那么我们需要重新登录。
      如果token 过期,重新刷新请求新的token值,如果refreshToken也过期,推出登陆,重新登陆。








4.这几个比较
4.1 Cookie和Session的区别
1、cookie数据存放在客户的浏览器上，session数据放在服务器上。
2、cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗,考虑到安全应当使用session。
3、session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能,考虑到减轻服务器性能方面，应当使用cookie。
4、单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。
5、所以个人建议：
将登陆信息等重要信息存放为session
其他信息如果需要保留，可以放在cookie中




4.2 Token和Session的区别

而Token，如果指的是OAuth Token或类似的机制的话，提供的是 认证 和 授权 ，
认证是针对用户，授权是针对App。其目的是让 某App有权利访问 某用户 的信息。这里的Token是唯一的。
不可以转移到其它App上，也不可以转到其它 用户 上。

token就是令牌，比如你授权（登录）一个程序时，他就是个依据，判断你是否已经授权该软件；
cookie就是写在客户端的一个txt文件，里面包括你登录信息之类的，这样你下次在登录某个网站，就会自动调用cookie自动登录用户名；






